<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title th:text="${article.title + ' - 동백일보'}">기사 제목 - 동백일보</title>
  <link rel="icon" href="/images/icon.jpg" type="image/jpeg">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="/css/common-styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=ZCOOL+XiaoWei&family=Noto+Serif+SC&display=swap" rel="stylesheet">
  <style>
    /* 기사 레이아웃 */
    .article-container {
      display: flex;
      gap: 30px;
      margin: 30px auto;
      padding: 0 20px;
    }

    .article-main {
      flex: 2;
      background-color: #fff;
      border: 1px solid #f0f0f0;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      overflow: hidden;
    }

    .article-sidebar {
      flex: 1;
    }

    /* 기사 타이틀 섹션 */
    .article-header {
      position: relative;
      padding: 0 0 20px 0;
      border-bottom: 1px solid #eaeaea;
    }

    .article-category {
      display: inline-block;
      background-color: var(--primary-dark);
      color: white;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 0.9rem;
      margin-bottom: 15px;
    }

    .article-title {
      font-size: 2.2rem;
      font-weight: 700;
      line-height: 1.3;
      color: #222;
      margin-bottom: 15px;
      letter-spacing: -0.5px;
    }

    .article-metadata {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      color: var(--dark-gray);
      font-size: 0.9rem;
    }

    .article-metadata span {
      margin-right: 20px;
      display: flex;
      align-items: center;
    }

    .article-metadata i {
      margin-right: 6px;
      color: var(--primary-color);
    }

    /* 기사 본문 */
    .article-body {
      padding: 25px;
      max-width: 750px;
      margin: 0 auto;
    }

    .article-image-container {
      margin: 0 -25px 25px;
      background-color: #f9f9f9;
      text-align: center;
    }

    .article-image {
      max-width: 100%;
      max-height: 500px;
      object-fit: contain;
    }

    .article-text {
      font-size: 1.1rem;
      line-height: 1.8;
      color: #333;
      margin-bottom: 25px;
    }

    .article-text p {
      margin-bottom: 20px;
    }

    /* 유튜브 동영상 컨테이너 스타일 */
    .youtube-container {
      position: relative;
      width: 100%;
      margin: 25px 0;
      padding-bottom: 56.25%; /* 16:9 비율 */
      height: 0;
      overflow: hidden;
    }

    .youtube-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 6px;
    }

    /* 기사 액션 */
    .article-actions {
      display: flex;
      gap: 15px;
      margin: 30px 0;
      padding: 15px 0;
      border-top: 1px solid var(--medium-gray);
    }

    .like-button, .share-button {
      display: flex;
      align-items: center;
      padding: 10px 18px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.95rem;
      border: none;
      transition: all 0.2s;
    }

    .like-button {
      background-color: var(--light-gray);
      color: #333;
    }

    .like-button i {
      margin-right: 8px;
      font-size: 1.1rem;
      color: var(--primary-color);
    }

    .like-button.liked {
      background-color: #ffeded;
      color: var(--primary-color);
    }

    .share-button {
      background-color: var(--primary-color);
      color: white;
    }

    .share-button i {
      margin-right: 8px;
    }

    /* 기사 푸터 */
    .article-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 25px;
      background-color: #f9f9f9;
      border-top: 1px solid #eee;
    }

    .admin-actions {
      display: none; /* 처음에는 숨겨진 상태 */
      gap: 10px;
    }

    .back-button, .edit-button, .delete-button {
      padding: 8px 15px;
      border-radius: 4px;
      font-size: 0.9rem;
      text-decoration: none;
      transition: background-color 0.2s;
    }

    .back-button {
      background-color: var(--light-gray);
      color: var(--dark-gray);
    }

    .back-button:hover {
      background-color: var(--medium-gray);
    }

    .edit-button {
      background-color: var(--primary-color);
      color: white;
    }

    .edit-button:hover {
      background-color: var(--primary-dark);
    }

    .delete-button {
      background-color: #e74c3c;
      color: white;
      border: none;
      cursor: pointer;
    }

    .delete-button:hover {
      background-color: #c0392b;
    }

    /* 관련 기사 */
    .related-articles {
      margin-top: 40px;
    }

    .related-title {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 20px;
      color: var(--primary-dark);
      padding-bottom: 10px;
      border-bottom: 2px solid var(--primary-dark);
    }

    .related-articles-list {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }

    .related-article-card {
      background-color: #fff;
      border: 1px solid #f0f0f0;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      padding: 15px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .related-article-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .related-article-title {
      font-size: 1.05rem;
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
      line-height: 1.4;
    }

    .related-article-card:hover .related-article-title {
      color: var(--primary-color);
    }

    .related-article-date {
      font-size: 0.85rem;
      color: var(--dark-gray);
    }

    /* 사이드바 */
    .sidebar-section {
      background-color: #fff;
      border: 1px solid #f0f0f0;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      margin-bottom: 20px;
      padding: 20px;
    }

    .sidebar-title {
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--primary-color);
      color: var(--primary-dark);
    }

    .trending-list li {
      padding: 12px 0;
      border-bottom: 1px solid #f0f0f0;
      cursor: pointer;
    }

    .trending-list li:last-child {
      border-bottom: none;
    }

    .trending-list .number {
      display: inline-block;
      width: 24px;
      height: 24px;
      background-color: var(--primary-color);
      color: white;
      text-align: center;
      line-height: 24px;
      border-radius: 4px;
      margin-right: 10px;
      font-size: 0.85rem;
      font-weight: bold;
    }

    .trending-title {
      font-size: 0.95rem;
      font-weight: 500;
      color: #333;
      transition: color 0.2s;
    }

    .trending-list li:hover .trending-title {
      color: var(--primary-color);
    }

    /* 속보 섹션 스타일 (사이드바용) */
    .breaking-news-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .breaking-news-item {
      display: flex;
      padding: 10px 0;
      border-bottom: 1px solid #f0f0f0;
      cursor: pointer;
    }

    .breaking-news-item:last-child {
      border-bottom: none;
    }

    .breaking-news-image {
      width: 70px;
      height: 50px;
      object-fit: cover;
      margin-right: 10px;
      border-radius: 4px;
    }

    .breaking-news-content {
      flex: 1;
    }

    .breaking-news-title {
      font-size: 0.95rem;
      font-weight: 500;
      color: #333;
      margin-bottom: 4px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .breaking-news-item:hover .breaking-news-title {
      color: var(--primary-color);
    }

    /* 댓글 섹션 스타일 */
    .comment-section {
      margin-top: 40px;
      padding-top: 30px;
      border-top: 1px solid #eaeaea;
    }

    .comment-header {
      margin-bottom: 20px;
    }

    .comment-title {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--primary-dark);
      margin-bottom: 5px;
    }

    .comment-subtitle {
      font-size: 0.9rem;
      color: var(--dark-gray);
    }

    /* 댓글 작성 폼 */
    .dc-comment-form {
      background-color: var(--light-gray);
      border: 1px solid var(--medium-gray);
      border-radius: 4px;
      padding: 15px;
      margin-bottom: 30px;
    }

    .dc-form-textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
      min-height: 80px;
      resize: vertical;
    }

    .dc-form-footer {
      display: flex;
      margin-top: 10px;
      border-top: 1px solid var(--medium-gray);
      padding-top: 10px;
    }

    .dc-form-user-info {
      flex: 1;
      display: flex;
      gap: 10px;
    }

    .dc-form-input {
      padding: 8px 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
      width: auto;
    }

    .dc-form-input::placeholder {
      color: #999;
    }

    .dc-form-button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 8px 15px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 4px;
    }

    .dc-form-button:hover {
      background-color: var(--primary-dark);
    }

    /* 댓글 목록 */
    .dc-comments-list {
      border-top: 1px solid var(--medium-gray);
    }

    .dc-comment-item {
      display: flex;
      padding: 12px 0;
      border-bottom: 1px solid var(--medium-gray);
      position: relative;
    }

    .dc-comment-user {
      width: 140px;
      font-size: 14px;
      padding: 0 15px;
      border-right: 1px solid var(--medium-gray);
    }

    .dc-comment-author {
      font-weight: bold;
      color: #333;
      display: block;
      margin-bottom: 5px;
    }

    .dc-comment-ip {
      color: var(--dark-gray);
      font-size: 12px;
      display: block;
      margin-bottom: 3px;
    }

    .dc-comment-date {
      color: var(--dark-gray);
      font-size: 12px;
    }

    .dc-comment-body {
      flex: 1;
      padding: 0 15px;
    }

    .dc-comment-content {
      color: #333;
      font-size: 14px;
      line-height: 1.5;
      word-break: break-all;
    }

    .dc-comment-actions {
      position: absolute;
      top: 12px;
      right: 10px;
      font-size: 12px;
    }

    .dc-comment-action-btn {
      color: var(--dark-gray);
      background: none;
      border: none;
      cursor: pointer;
      margin-left: 8px;
      padding: 0;
    }

    .dc-comment-action-btn:hover {
      color: var(--primary-color);
      text-decoration: underline;
    }

    /* 대댓글 스타일 */
    .dc-reply-comment {
      background-color: var(--light-gray);
      padding-left: 15px;
    }

    .dc-reply-comment .dc-comment-user {
      width: 125px;
    }

    /* 댓글 없음 */
    .dc-empty-comments {
      text-align: center;
      padding: 30px 0;
      color: var(--dark-gray);
      font-style: italic;
      font-size: 14px;
      border-bottom: 1px solid var(--medium-gray);
    }

    /* 삭제 폼 */
    .dc-delete-form {
      background: var(--light-gray);
      border: 1px solid var(--medium-gray);
      border-radius: 4px;
      padding: 15px;
      margin-top: 10px;
      display: none;
    }

    .dc-delete-form-content {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .dc-delete-label {
      font-size: 14px;
      color: var(--dark-gray);
    }

    .dc-delete-input {
      padding: 8px 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
      width: 120px;
    }

    .dc-delete-button {
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 8px 10px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 4px;
    }

    .dc-cancel-button {
      background-color: #ccc;
      color: #333;
      border: none;
      padding: 8px 10px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 4px;
    }

    .dc-delete-button:hover {
      background-color: #c0392b;
    }

    /* 반응형 */
    @media (max-width: 1200px) {
      .container {
        width: 100%;
      }
    }

    @media (max-width: 992px) {
      .article-container {
        flex-direction: column;
      }

      .article-title {
        font-size: 1.8rem;
      }

      .related-articles-list {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .related-articles-list {
        grid-template-columns: 1fr;
      }

      .article-title {
        font-size: 1.6rem;
      }

      .article-body {
        padding: 15px;
      }

      .article-image-container {
        margin: 0 -15px 15px;
      }

      .dc-form-footer {
        flex-direction: column;
        gap: 10px;
      }

      .dc-form-user-info {
        flex-direction: column;
        width: 100%;
      }

      .dc-form-input {
        width: 100%;
        margin-bottom: 8px;
      }

      .dc-form-button {
        width: 100%;
        padding: 10px;
      }

      .dc-comment-item {
        flex-direction: column;
      }

      .dc-comment-user {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid var(--medium-gray);
        padding: 0 10px 6px 10px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
      }

      .dc-comment-author-wrapper {
        display: flex;
        flex-direction: column;
      }

      .dc-comment-body {
        padding: 0 10px;
      }

      .dc-comment-actions {
        position: static;
        text-align: right;
        margin-top: 10px;
      }
    }
  </style>
</head>

<body>
<div class="container">
  <!-- 헤더 영역 -->
  <div th:replace="fragment/common-header.html :: header"></div>
  <div class="article-container">
    <main class="article-main">
      <!-- 기사 헤더 -->
      <div class="article-body">
        <div class="article-header">
          <div class="article-category" th:text="${article.category}">카테고리</div>
          <h1 class="article-title" th:text="${article.title}">기사 제목 - 더 크고 굵게 표시됩니다</h1>
          <div class="article-metadata">
            <span><i class="fas fa-user"></i> <span th:text="${article.author}">저자</span></span>
            <span><i class="fas fa-calendar"></i> <span th:text="${#temporals.format(article.createdAt, 'yyyy년 MM월 dd일 HH:mm')}">작성일</span></span>
            <span><i class="fas fa-eye"></i> <span th:text="${article.viewCount}">조회수</span></span>
            <span><i class="fas fa-heart"></i> <span class="like-count" th:attr="data-article-id=${article.id}" th:text="${article.likeCount}">좋아요수</span></span>
          </div>
        </div>

        <!-- 기사 이미지 -->
        <div class="article-image-container" th:if="${article.imageUrl != null}">
          <img th:src="${article.imageUrl}" th:alt="${article.title}" class="article-image" loading="lazy">
        </div>

        <!-- 기사 본문 -->
        <div class="article-text" th:utext="${@articleContentFormatter.format(article.content)}">
          기사 내용이 여기에 표시됩니다. 더 좁은 폭과 적절한 여백으로 가독성이 높아집니다.
        </div>

        <!-- 기사 액션 -->
        <div class="article-actions">
          <button class="like-button"
                  th:data-article-id="${article.id}"
                  data-liked="false">
            <i class="far fa-heart"></i> 좋아요
          </button>

          <button class="share-button" onclick="shareArticle()">
            <i class="fas fa-share-alt"></i> 공유하기
          </button>
        </div>

        <!-- 댓글 섹션 -->
        <div class="comment-section">
          <div class="comment-header">
            <h2 class="comment-title">댓글 <span th:text="${comments != null ? comments.size() : 0}">0</span>개</h2>
            <p class="comment-subtitle">이 기사에 대한 의견을 남겨주세요</p>
          </div>

          <!-- 댓글 작성 폼 -->
          <div class="dc-comment-form">
            <form th:action="@{/articles/{id}/comments(id=${article.id})}" method="post">
              <textarea name="content" class="dc-form-textarea" required placeholder="댓글 내용을 입력해주세요."></textarea>

              <div class="dc-form-footer">
                <div class="dc-form-user-info">
                  <input type="text" name="nickname" class="dc-form-input" required placeholder="닉네임">
                  <input type="password" name="password" class="dc-form-input" required placeholder="비밀번호">
                </div>
                <button type="submit" class="dc-form-button">등록</button>
              </div>
            </form>
          </div>

          <!-- 댓글 목록 -->
          <div class="dc-comments-list">
            <!-- 댓글이 없는 경우 -->
            <div th:if="${comments == null || comments.isEmpty()}" class="dc-empty-comments">
              <p>등록된 댓글이 없습니다.</p>
            </div>

            <!-- 댓글 항목 -->
            <div th:each="comment : ${comments}" th:if="${comments != null && !comments.isEmpty()}" class="dc-comment-item">
              <div class="dc-comment-user">
                <div class="dc-comment-author-wrapper">
                  <span class="dc-comment-author" th:text="${comment.nickname}">ㅇㅇ</span>
                  <span class="dc-comment-ip">(123.456.*.*)</span>
                </div>
                <span class="dc-comment-date" th:text="${#temporals.format(comment.createdAt, 'yyyy.MM.dd HH:mm:ss')}">2025.03.21 14:30:25</span>
              </div>

              <div class="dc-comment-body">
                <p class="dc-comment-content" th:text="${comment.content}">댓글 내용이 이곳에 표시됩니다.</p>

                <div class="dc-comment-actions">
                  <button type="button" class="dc-comment-action-btn" th:onclick="'showReplyForm(' + ${comment.id} + ')'">답글</button>
                  <button type="button" class="dc-comment-action-btn" th:onclick="'showDeleteForm(' + ${comment.id} + ')'">삭제</button>
                </div>

                <!-- 삭제 폼 (기본적으로 숨겨져 있음) -->
                <div th:id="'delete-form-' + ${comment.id}" class="dc-delete-form">
                  <form th:action="@{/articles/{articleId}/comments/{commentId}/delete(articleId=${article.id},commentId=${comment.id})}" method="post">
                    <div class="dc-delete-form-content">
                      <span class="dc-delete-label">비밀번호 확인</span>
                      <input type="password" name="password" class="dc-delete-input" required>
                      <button type="submit" class="dc-delete-button">삭제</button>
                      <button type="button" class="dc-cancel-button" th:onclick="'hideDeleteForm(' + ${comment.id} + ')'">취소</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 관련 기사 -->
        <div class="related-articles" th:if="${relatedArticles != null && !relatedArticles.empty}">
          <h3 class="related-title">관련 기사</h3>
          <div class="related-articles-list">
            <div th:each="relatedArticle : ${relatedArticles}"
                 class="related-article-card"
                 th:if="${relatedArticle.id != article.id}"
                 th:onclick="'window.location.href = \'' + @{/articles/{id}(id=${relatedArticle.id})} + '\''">
              <h4 class="related-article-title" th:text="${relatedArticle.title}">관련 기사 제목</h4>
              <div class="related-article-date" th:text="${#temporals.format(relatedArticle.createdAt, 'yyyy년 MM월 dd일')}">2023년 5월 10일</div>
            </div>
          </div>
        </div>
      </div>

      <!-- 기사 푸터 -->
      <div class="article-footer">
        <a href="/articles" class="back-button">
          <i class="fas fa-arrow-left"></i> 목록으로
        </a>
        <div class="admin-actions" id="adminActions">
          <a th:href="@{/articles/{id}/edit(id=${article.id})}" class="edit-button">
            <i class="fas fa-edit"></i> 수정
          </a>
          <form th:action="@{/articles/{id}(id=${article.id})}" method="post" style="display: inline;">
            <input type="hidden" name="_method" value="DELETE">
            <button type="submit" class="delete-button" onclick="return confirm('정말 삭제하시겠습니까?')">
              <i class="fas fa-trash"></i> 삭제
            </button>
          </form>
        </div>
      </div>
    </main>

    <!-- 사이드바 -->
    <aside class="article-sidebar">
      <!-- 많이 본 뉴스 -->
      <div class="sidebar-section">
        <h3 class="sidebar-title">많이 본 뉴스</h3>
        <ul class="trending-list">
          <li th:each="trendingArticle, stat : ${@articleService.findTrendingArticles()}"
              th:if="${stat.index < 5}"
              th:onclick="'window.location.href = \'' + @{/articles/{id}(id=${trendingArticle.id})} + '\''">
            <span class="number" th:text="${stat.count}">1</span>
            <span class="trending-title" th:text="${trendingArticle.title}">인기 뉴스 제목</span>
          </li>
        </ul>
      </div>

      <!-- 속보 섹션 -->
      <div class="sidebar-section">
        <h3 class="sidebar-title">속보</h3>
        <ul class="breaking-news-list">
          <li th:each="breaking, stat : ${@articleService.findLatestArticles()}"
              th:if="${stat.index < 5}"
              class="breaking-news-item"
              th:onclick="'window.location.href = \'' + @{/articles/{id}(id=${breaking.id})} + '\''">
            <img th:src="${breaking.imageUrl != null ? breaking.imageUrl : '/images/placeholder/default.svg'}"
                 th:alt="${breaking.title}" class="breaking-news-image" loading="lazy">
            <div class="breaking-news-content">
              <h4 class="breaking-news-title" th:text="${breaking.title}">속보 기사 제목</h4>
            </div>
          </li>
        </ul>
      </div>

      <!-- 카테고리별 뉴스 -->
      <div class="sidebar-section">
        <h3 class="sidebar-title" th:with="categoryKo=${article.category == 'world' ? '국제' :
                                          article.category == 'politic' ? '정치' :
                                          article.category == 'economy' ? '경제' :
                                          article.category == 'industry' ? '산업' :
                                          article.category == 'culture' ? '예술' :
                                          article.category == 'column' ? '칼럼' :
                                          article.category == 'video' ? '영상' :
                                          article.category}"
            th:text="${categoryKo + ' 카테고리 뉴스'}">카테고리 뉴스</h3>
        <ul class="trending-list">
          <li th:each="categoryArticle, stat : ${@articleService.findLatestArticlesByCategory(article.category)}"
              th:if="${stat.index < 5 && categoryArticle.id != article.id}"
              th:onclick="'window.location.href = \'' + @{/articles/{id}(id=${categoryArticle.id})} + '\''">
            <span class="trending-title" th:text="${categoryArticle.title}">카테고리 뉴스 제목</span>
          </li>
        </ul>
      </div>
    </aside>
  </div>

  <!-- 푸터 영역 -->
  <div th:replace="fragment/common-footer :: footer"></div>
</div>

<!-- 검색 오버레이 -->
<div id="searchOverlay" class="search-overlay"></div>

<!-- 자바스크립트 -->
<!-- 자바스크립트 -->
<script src="js/common-script.js"></script>
<script>
  // 좋아요 버튼
  const likeButton = document.querySelector('.like-button');
  const adminActions = document.getElementById('adminActions');

  if (likeButton) {
    const articleId = likeButton.getAttribute('data-article-id');
    const likeCountElement = document.querySelector('.like-count');

    // 로컬 스토리지에서 좋아요 상태 가져오기
    const isLiked = localStorage.getItem(`liked_${articleId}`) === 'true';

    // 초기 상태 설정
    if (isLiked) {
      likeButton.classList.add('liked');
      likeButton.innerHTML = '<i class="fas fa-heart"></i> 좋아요 취소';
    }

    likeButton.addEventListener('click', function() {
      const isCurrentlyLiked = likeButton.classList.contains('liked');
      const url = isCurrentlyLiked
              ? `/articles/${articleId}/unlike`
              : `/articles/${articleId}/like`;

      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        }
      })
              .then(response => response.json())
              .then(data => {
                // 좋아요 수 업데이트
                if (likeCountElement) {
                  likeCountElement.textContent = data.likeCount;
                }

                // 버튼 상태 업데이트
                if (isCurrentlyLiked) {
                  likeButton.classList.remove('liked');
                  likeButton.innerHTML = '<i class="far fa-heart"></i> 좋아요';
                  localStorage.removeItem(`liked_${articleId}`);
                } else {
                  likeButton.classList.add('liked');
                  likeButton.innerHTML = '<i class="fas fa-heart"></i> 좋아요 취소';
                  localStorage.setItem(`liked_${articleId}`, 'true');
                }
              })
              .catch(error => {
                console.error('좋아요 처리 중 오류가 발생했습니다:', error);
              });
    });
  }

  // 유튜브 링크 처리
  processYoutubeLinks();

  // 키보드 단축키 핸들러 추가 (Ctrl+Shift+?)
  document.addEventListener('keydown', function(event) {
    // Ctrl+Shift+? (물음표 키코드는 191)
    if (event.ctrlKey && event.shiftKey && event.keyCode === 191) {
      event.preventDefault(); // 기본 브라우저 동작 방지

      // admin-actions 요소의 display 상태를 토글
      if (adminActions.style.display === 'flex') {
        adminActions.style.display = 'none';
      } else {
        adminActions.style.display = 'flex';
      }
    }
  });

  // 유튜브 링크를 임베드로 변환하는 함수
  function processYoutubeLinks() {
    const articleText = document.querySelector('.article-text');
    const articleImageContainer = document.querySelector('.article-image-container');
    if (!articleText) return;

    // 기사 본문에 포함된 유튜브 링크 검색
    const paragraphs = articleText.getElementsByTagName('p');
    for (let i = 0; i < paragraphs.length; i++) {
      const paragraph = paragraphs[i];
      const text = paragraph.textContent || '';

      if (text.includes('youtu.be/') || text.includes('youtube.com/watch')) {
        const videoId = extractYoutubeId(text);
        if (videoId) {
          const embedContainer = document.createElement('div');
          embedContainer.className = 'youtube-container';
          embedContainer.innerHTML = `<iframe src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe>`;

          // 대표 이미지가 있으면 그 위에 배치하고, 없으면 첫 번째 단락 위에 배치
          if (articleImageContainer) {
            // 대표 이미지가 있으면 해당 이미지 컨테이너를 숨김
            articleImageContainer.style.display = 'none';
            articleImageContainer.parentNode.insertBefore(embedContainer, articleImageContainer);
          } else {
            // 대표 이미지가 없으면 본문 맨 위에 삽입
            articleText.insertBefore(embedContainer, articleText.firstChild);
          }

          // 첫 번째 유튜브 링크만 처리하고 종료 (여러 비디오가 있는 경우 한 개만 처리)
          break;
        }
      }
    }
  }

  // 유튜브 링크에서 비디오 ID 추출
  function extractYoutubeId(text) {
    // youtu.be 형식
    let match = text.match(/youtu\.be\/([a-zA-Z0-9_-]{11})/);
    if (match && match[1]) return match[1];

    // youtube.com/watch 형식
    match = text.match(/youtube\.com\/watch\?v=([a-zA-Z0-9_-]{11})/);
    if (match && match[1]) return match[1];

    // youtube.com/embed 형식
    match = text.match(/youtube\.com\/embed\/([a-zA-Z0-9_-]{11})/);
    if (match && match[1]) return match[1];

    return null;
  }

  // 공유 기능
  function shareArticle() {
    // 현재 페이지 URL
    const url = window.location.href;

    // 문서의 제목 (h1 태그에서 가져옴)
    const title = document.querySelector('.article-title').textContent;

    // 웹 공유 API 사용 (지원되는 브라우저의 경우)
    if (navigator.share) {
      navigator.share({
        title: title,
        url: url
      }).catch(console.error);
    } else {
      // 클립보드에 복사
      const tempInput = document.createElement('input');
      document.body.appendChild(tempInput);
      tempInput.value = url;
      tempInput.select();
      document.execCommand('copy');
      document.body.removeChild(tempInput);

      alert('기사 주소가 클립보드에 복사되었습니다.');
    }
  }

  // 댓글 기능 관련 자바스크립트
  function showDeleteForm(commentId) {
    // 삭제 폼 표시
    const deleteForm = document.getElementById(`delete-form-${commentId}`);
    if (deleteForm) {
      deleteForm.style.display = 'block';
    }
  }

  function hideDeleteForm(commentId) {
    // 삭제 폼 숨기기
    const deleteForm = document.getElementById(`delete-form-${commentId}`);
    if (deleteForm) {
      deleteForm.style.display = 'none';
    }
  }

  function showReplyForm(commentId) {
    alert('대댓글 기능은 현재 개발 중입니다.');
  }
</script>
</body>
</html>